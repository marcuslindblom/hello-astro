---
import Welcome from '../components/Welcome.astro';
import Layout from '../layouts/Layout.astro';
import { store, type IDocumentSession } from 'strife:store';
import { QueryStatistics } from "ravendb";
import type { Home } from '../types/Home';

const session: IDocumentSession = store.openSession();
let stats: QueryStatistics = new QueryStatistics();

const home: Home = (await session
	.query({ indexName: 'Content/ByUrl' })
	.whereEquals('url', '/')
	.selectFields(['displayName', 'description'])
	.statistics(s => stats = s)
	.firstOrNull()) as Home;

const numberOfResults = stats.totalResults; // Get results count
const queryDuration = stats.durationInMs;   // Get query duration
const indexNameUsed = stats.indexName;      // Get index name used in query

console.log(numberOfResults, queryDuration, indexNameUsed, home.description);

// Welcome to Astro! Wondering what to do next? Check out the Astro documentation at https://docs.astro.build
// Don't want to use any of this? Delete everything in this file, the `assets`, `components`, and `layouts` directories, and start fresh.
---

<Layout>
  <Welcome heading={home.displayName} />
</Layout>
